<% ids = {row: dom_id(@quantity, :edit),
          hidden_row: dom_id(@quantity),
          link: nil,
          form_tag: dom_id(@quantity, :edit, :form)} %>

<%= turbo_stream.append :quantity_form do %>
  <%= tabular_form_with model: @quantity, html: {id: ids[:form_tag]} do %>
    <!-- ...existing code for form fields... -->
  <% end %>
<% end %>

<%= turbo_stream.hide ids[:hidden_row] %>
<%= turbo_stream.remove ids[:row] %>
<%= turbo_stream.after @quantity, partial: 'form', locals: ids -%>
